<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>如何通过使用Apache代理，优化、提高 Plone 的性能 | ICT经验网</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">如何通过使用Apache代理，优化、提高 Plone 的性能</h1><a id="logo" href="/.">ICT经验网</a><p class="description">关注Linux、PHP、WordPress、虚拟化、深度学习等</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">如何通过使用Apache代理，优化、提高 Plone 的性能</h1><div class="post-meta">2009-04-07<span> | </span><span class="category"><a href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.3k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 19</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#A-sample-VirtualHost-section-for-using-Apache-as-a-webserver"><span class="toc-number">1.</span> <span class="toc-text">A sample VirtualHost section for using Apache as a webserver</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#instead-of-Zope"><span class="toc-number">2.</span> <span class="toc-text">instead of Zope.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ServerName-is-the-url-of-your-website"><span class="toc-number">3.</span> <span class="toc-text">ServerName is the url of your website.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Add-serverAlias-lines-for-other-doamin-names-that-should"><span class="toc-number">4.</span> <span class="toc-text">Add serverAlias lines for other doamin names that should</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#point-to-this-website-They-will-be-rewritten-by-Apache-to"><span class="toc-number">5.</span> <span class="toc-text">point to this website. They will be rewritten by Apache to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-ServerName-so-that-anyone-going-to-www-yoursite-com"><span class="toc-number">6.</span> <span class="toc-text">the ServerName, so that anyone going to www.yoursite.com</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#will-be-invisibly-redirected-to-yoursite-com-in-their-browser"><span class="toc-number">7.</span> <span class="toc-text">will be invisibly redirected to yoursite.com in their browser.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ServerAdmin-is-your-email-address-which-shows-up-on-error"><span class="toc-number">8.</span> <span class="toc-text">ServerAdmin is your email address, which shows up on error</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pages-when-Apache-cannot-connect-to-Zope"><span class="toc-number">9.</span> <span class="toc-text">pages when Apache cannot connect to Zope.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-ProxyPass-and-ProxyPassReverse-lines-are-the-magic"><span class="toc-number">10.</span> <span class="toc-text">The ProxyPass and ProxyPassReverse lines are the magic</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ingredients-They-rewite-requests-to-http-yoursite-com-and"><span class="toc-number">11.</span> <span class="toc-text">ingredients. They rewite requests to http:&#x2F;&#x2F;yoursite.com and</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pass-the-entire-request-rhough-to-Zope-on"><span class="toc-number">12.</span> <span class="toc-text">pass the entire request rhough to Zope on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http-yoursite-com-8080-The-VirtualHostBase-ensures-that"><span class="toc-number">13.</span> <span class="toc-text">http:&#x2F;&#x2F;yoursite.com:8080. The VirtualHostBase ensures that</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#when-the-page-goes-back-to-the-browser-it-goes-out-through"><span class="toc-number">14.</span> <span class="toc-text">when the page goes back to the browser, it goes out through</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Apache-and-appears-to-have-come-from-http-yoursite-com"><span class="toc-number">15.</span> <span class="toc-text">Apache, and appears to have come from http:&#x2F;&#x2F;yoursite.com.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-line-is-made-up-from"><span class="toc-number">16.</span> <span class="toc-text">The line is made up from:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ProxyPass-or-ProxyPassReverse"><span class="toc-number">17.</span> <span class="toc-text">ProxyPass or ProxyPassReverse</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-the-url-at-http-yoursite-com-that-you-wish-to-use-to"><span class="toc-number">18.</span> <span class="toc-text">&#x2F; is the url at http:&#x2F;&#x2F;yoursite.com that you wish to use to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#point-to-the-Zope-site-You-could-keep-http-yoursite-com-as-a"><span class="toc-number">19.</span> <span class="toc-text">point to the Zope site. You could keep http:&#x2F;&#x2F;yoursite.com as a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#flat-HTML-site-in-Apache-and-replace-with-zope-to-make"><span class="toc-number">20.</span> <span class="toc-text">flat HTML site in Apache, and replace &#x2F; with &#x2F;zope to make</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http-yoursite-com-zope-point-to-your-zope-site"><span class="toc-number">21.</span> <span class="toc-text">http:&#x2F;&#x2F;yoursite&#x2F;com&#x2F;zope point to your zope site.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http-yoursite-com-8080-is-the-address-that-your-zope-is"><span class="toc-number">22.</span> <span class="toc-text">http:&#x2F;&#x2F;yoursite.com:8080 is the address that your zope is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#running-on"><span class="toc-number">23.</span> <span class="toc-text">running on.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VirtualHostBase-http-yoursite-com-80-makes-sure-that-zope"><span class="toc-number">24.</span> <span class="toc-text">&#x2F;VirtualHostBase&#x2F;http&#x2F;yoursite.com:80 makes sure that zope</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#thinks-it-is-running-at-http-yousite-com-instead-of-at"><span class="toc-number">25.</span> <span class="toc-text">thinks it is running at http:&#x2F;&#x2F;yousite.com instead of at</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http-yoursite-com-8080-You-don%E2%80%99t-have-to-do-anything-else"><span class="toc-number">26.</span> <span class="toc-text">http:&#x2F;&#x2F;yoursite.com:8080. You don’t have to do anything else</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-Zope-to-make-this-work"><span class="toc-number">27.</span> <span class="toc-text">in Zope to make this work.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#yourplonesite-is-the-location-of-your-Plone-Site-within-Zope"><span class="toc-number">28.</span> <span class="toc-text">&#x2F;yourplonesite is the location of your Plone Site within Zope.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-you-added-a-Plone-Site-into-the-root-of-your-Zope-with-an-id"><span class="toc-number">29.</span> <span class="toc-text">If you added a Plone Site into the root of your Zope with an id</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-%E2%80%98mysite%E2%80%99-then-you-just-change-this-bit-to-mysite"><span class="toc-number">30.</span> <span class="toc-text">of ‘mysite’, then you just change this bit to &#x2F;mysite</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VirtualHostRoot-makes-your-Plone-site-think-it-is-the-root-of-the-site"><span class="toc-number">31.</span> <span class="toc-text">&#x2F;VirtualHostRoot&#x2F; makes your Plone site think it is the root of the site.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CacheRoot-is-the-location-on-the-filesystem-to-store-files-that"><span class="toc-number">32.</span> <span class="toc-text">CacheRoot is the location on the filesystem to store files that</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Apache-caches-This-directory-must-be-created-and-the-user-that"><span class="toc-number">33.</span> <span class="toc-text">Apache caches. This directory must be created, and the user that</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Apache-runs-as-must-have-full-write-permissions-to-it"><span class="toc-number">34.</span> <span class="toc-text">Apache runs as must have full write permissions to it.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CacheSize-determines-how-big-this-cache-can-get-in-KB-It%E2%80%99s-a"><span class="toc-number">35.</span> <span class="toc-text">CacheSize determines how big this cache can get in KB. It’s a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#good-idea-that-this-number-is-about-30-less-than-the-available"><span class="toc-number">36.</span> <span class="toc-text">good idea that this number is about 30% less than the available</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#space-in-the-CacheRoot-directory-Here-we-choose-to-cache-10MB"><span class="toc-number">37.</span> <span class="toc-text">space in the CacheRoot directory. Here we choose to cache 10MB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-data-which-is-enough-for-a-personal-website-but-not-for"><span class="toc-number">38.</span> <span class="toc-text">of data, which is enough for a personal website, but not for</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#anything-larger"><span class="toc-number">39.</span> <span class="toc-text">anything larger.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CacheGcInterval-specifies-how-often-in-hours-to-examine-the"><span class="toc-number">40.</span> <span class="toc-text">CacheGcInterval specifies how often (in hours) to examine the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cache-and-delete-obsolete-files"><span class="toc-number">41.</span> <span class="toc-text">cache and delete obsolete files.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CacheLastModifiedFactor-allows-the-estimation-of-an-expiry-date"><span class="toc-number">42.</span> <span class="toc-text">CacheLastModifiedFactor allows the estimation of an expiry date</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#for-a-page-if-it-doesn%E2%80%99t-have-an-expiry-date-specified-in-the"><span class="toc-number">43.</span> <span class="toc-text">for a page if it doesn’t have an expiry-date specified in the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTP-headers-returned-from-Zope-This-is-based-on-time-since"><span class="toc-number">44.</span> <span class="toc-text">HTTP headers returned from Zope. This is based on (time since</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#last-modification-CacheLastModifiedFactor-so-that-content"><span class="toc-number">45.</span> <span class="toc-text">last modification * CacheLastModifiedFactor), so that content</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#that-is-ten-hours-old-would-be-given-an-expiry-date-of-1-hour-in"><span class="toc-number">46.</span> <span class="toc-text">that is ten hours old would be given an expiry date of 1 hour in</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-future"><span class="toc-number">47.</span> <span class="toc-text">the future.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CacheDefaultExpire-sets-a-default-expiry-time-of-1-hour-into-the"><span class="toc-number">48.</span> <span class="toc-text">CacheDefaultExpire sets a default expiry time of 1 hour into the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#future-for-cached-pages"><span class="toc-number">49.</span> <span class="toc-text">future for cached pages.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CacheDirLength-sets-the-number-of-characters-used-in-directory"><span class="toc-number">50.</span> <span class="toc-text">CacheDirLength sets the number of characters used in directory</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#names-for-subdirectories-of-CacheRoot"><span class="toc-number">51.</span> <span class="toc-text">names for subdirectories of CacheRoot</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-following-definitions-set-expiry-times-for-various-content"><span class="toc-number">52.</span> <span class="toc-text">The following definitions set expiry times for various content</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#types-In-this-list-each-content-type-defined-is-cached-for-a"><span class="toc-number">53.</span> <span class="toc-text">types. In this list, each content type defined is cached for a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#maximum-period-of-1-hour-3600-seconds-before-it-must-be-checked"><span class="toc-number">54.</span> <span class="toc-text">maximum period of 1 hour (3600 seconds) before it must be checked</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#again-Non-listed-content-types-are-not-cached"><span class="toc-number">55.</span> <span class="toc-text">again. Non-listed content types are not cached.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set-HTTP-Expires-and-Cache-Control-headers"><span class="toc-number">56.</span> <span class="toc-text">Set HTTP Expires and Cache-Control headers</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#note-that-in-the-original-this-line-was-commented-out"><span class="toc-number">57.</span> <span class="toc-text">note that in the original, this line was commented out.</span></a></li></ol></div></div><div class="post-content"><p><a target="_blank" rel="noopener" href="http://www.mangbar.com/document/5d023b2114eab9f40114f76d30461133">http://www.mangbar.com/document/5d023b2114eab9f40114f76d30461133</a><br>如何优化、提高 Plone 的性能</p>
<p>大家关注的Plone的主要问题之一是速度。不可否认，如果你第一次使用Plone，会感觉很慢。</p>
<p>总体来说，Plone不是世界上最快的系统。从一开始，Plone就是用Python构建的，Python是一种不需要编译的解释语言。这种语言带来了巨大的灵活性，但是无法追到最快速的应用。</p>
<p>影响Plone速度的首要因素，Plone是一个非常复杂的系统。对于一个平常的HTML网站，可以做到从服务器载入只需要百分之一秒的时间（显然在不考虑网络条件下），Plone的主页面是完全动态地根据每个人的每次请求生成出来的。这导致可能需要5－6秒钟的时间载入一个页面。此外，Plone 中包含的javascript和css页面超过100kB,这样会导致超过30秒的时间下载，这就会导致非常慢的感觉。显然，如果你同一时间内有更多的用户访问，plone基本上就变得不可用了。</p>
<p>这可不是一个好消息。</p>
<p>不过，情况并不是完全糟糕。Plone底层的Zope应用程序从来就没有说是一个web服务器。还好，我们可以使用Apache作为前端Web服务器，并通过反向代理的程序来处理所有来自Web的连接，</p>
<p>本文后面部分中，所有的比对数据都是在一台1.8GHz, RAM 128MB的Intel Celeron服务器上测试的。该服务器运行基本的Redhat 7.3版本。Python使用Python.org上预编译好的RPM包，而Zope也是编译好的。使用的Plone版本是Plone 2.0 rc3.</p>
<p>要设置一个反向代理非常容易。首先配置你的Zope不要运行在80端口上。你可以修改Zope 2.5&#x2F;2.6的启动脚本，或者编辑Zope 2.7中zope.conf的基本端口参数。下面的例子中，基本端口设置为8080, 就是说Zope会运行在8080端口上。</p>
<p>访问一下<a href="http://yoursite.com:8080进行测试。">http://yoursite.com:8080进行测试。</a></p>
<p>现在，你需要在你的Zope的根文件夹中添加一个 Virtual Host Monster 。 名称可以任意，不过必须添加在Zope的根文件夹中，而不是Plone站点的根文件夹中。</p>
<p>你还要边界portal_skins&#x2F;plone_templates&#x2F;global_cache_settings模板来阻止Plone发送出 ‘Pragma: no-cache’ 的HTTP报头。缺省情况下，Plone屏蔽了所有的HTTP缓存。在ZMI中找到该模板，把它定制到你的custom皮肤文件夹中。现在，把它的内容编辑成：:</p>
<p>&lt;metal:cacheheaders define-macro&#x3D;”cacheheaders”&gt;<br>&lt;metal:block tal:define&#x3D;”dummy python:request.RESPONSE.setHeader(‘Content-Type’, ‘text&#x2F;html;;charse t&#x3D; %s’ % charset)” &#x2F;&gt;<br>&lt;metal:block tal:define&#x3D;”dummy python:request.RESPONSE.setHeader(‘Content-Language’, lang)” &#x2F;&gt;<br>&lt;metal:block tal:define&#x3D;”dummy python:request.RESPONSE.setHeader(‘Expires’, ‘Sat, 1 Jan 2000 00:00:00 GMT’)” &#x2F;&gt;<br></metal:cacheheaders></p>
<p>好，现在安装apache.(我使用的是Apache 1.3, 不过稍作调整即可适用于Apache 2).</p>
<p>这样，apache会运行在80端口上，你可以访问<a target="_blank" rel="noopener" href="http://yoursite.com的缺省页面/">http://yoursite.com的缺省页面</a>.</p>
<p>现在需要编辑apache的配置文件，其中有几个需要检查的事项：</p>
<ol>
<li></li>
</ol>
<p>保证mod_proxy激活。找到载入libproxy.so模块的语句，确保一下代码行没有被注释掉:</p>
<p>LoadModule proxy_module modules&#x2F;libproxy.so<br> AddModule mod_proxy.c</p>
<ol start="2">
<li></li>
</ol>
<p>为你的域名设置一个虚拟主机VirtualHost, 该虚拟主机为了将请求传递给Zope,需要使用反向代理。下面的例子中的代码可以剪切并粘贴到&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf配置文件的底部，你只需要编译几行:</p>
<p>&lt;VirtualHost *&gt;</p>
<h1 id="A-sample-VirtualHost-section-for-using-Apache-as-a-webserver"><a href="#A-sample-VirtualHost-section-for-using-Apache-as-a-webserver" class="headerlink" title="A sample VirtualHost section for using Apache as a webserver"></a>A sample VirtualHost section for using Apache as a webserver</h1><h1 id="instead-of-Zope"><a href="#instead-of-Zope" class="headerlink" title="instead of Zope."></a>instead of Zope.</h1><h1 id="ServerName-is-the-url-of-your-website"><a href="#ServerName-is-the-url-of-your-website" class="headerlink" title="ServerName is the url of your website."></a>ServerName is the url of your website.</h1><p> ServerName yoursite.com</p>
<h1 id="Add-serverAlias-lines-for-other-doamin-names-that-should"><a href="#Add-serverAlias-lines-for-other-doamin-names-that-should" class="headerlink" title="Add serverAlias lines for other doamin names that should"></a>Add serverAlias lines for other doamin names that should</h1><h1 id="point-to-this-website-They-will-be-rewritten-by-Apache-to"><a href="#point-to-this-website-They-will-be-rewritten-by-Apache-to" class="headerlink" title="point to this website. They will be rewritten by Apache to"></a>point to this website. They will be rewritten by Apache to</h1><h1 id="the-ServerName-so-that-anyone-going-to-www-yoursite-com"><a href="#the-ServerName-so-that-anyone-going-to-www-yoursite-com" class="headerlink" title="the ServerName, so that anyone going to www.yoursite.com"></a>the ServerName, so that anyone going to <a target="_blank" rel="noopener" href="http://www.yoursite.com/">www.yoursite.com</a></h1><h1 id="will-be-invisibly-redirected-to-yoursite-com-in-their-browser"><a href="#will-be-invisibly-redirected-to-yoursite-com-in-their-browser" class="headerlink" title="will be invisibly redirected to yoursite.com in their browser."></a>will be invisibly redirected to yoursite.com in their browser.</h1><p> ServerAlias <a target="_blank" rel="noopener" href="http://www.yoursite.com/">www.yoursite.com</a></p>
<h1 id="ServerAdmin-is-your-email-address-which-shows-up-on-error"><a href="#ServerAdmin-is-your-email-address-which-shows-up-on-error" class="headerlink" title="ServerAdmin is your email address, which shows up on error"></a>ServerAdmin is your email address, which shows up on error</h1><h1 id="pages-when-Apache-cannot-connect-to-Zope"><a href="#pages-when-Apache-cannot-connect-to-Zope" class="headerlink" title="pages when Apache cannot connect to Zope."></a>pages when Apache cannot connect to Zope.</h1><p> ServerAdmin <a href="mailto:&#119;&#x65;&#x62;&#x6d;&#97;&#115;&#x74;&#x65;&#114;&#64;&#x79;&#111;&#117;&#x72;&#x73;&#x69;&#x74;&#101;&#x2e;&#x63;&#111;&#x6d;">&#119;&#x65;&#x62;&#x6d;&#97;&#115;&#x74;&#x65;&#114;&#64;&#x79;&#111;&#117;&#x72;&#x73;&#x69;&#x74;&#101;&#x2e;&#x63;&#111;&#x6d;</a></p>
<h1 id="The-ProxyPass-and-ProxyPassReverse-lines-are-the-magic"><a href="#The-ProxyPass-and-ProxyPassReverse-lines-are-the-magic" class="headerlink" title="The ProxyPass and ProxyPassReverse lines are the magic"></a>The ProxyPass and ProxyPassReverse lines are the magic</h1><h1 id="ingredients-They-rewite-requests-to-http-yoursite-com-and"><a href="#ingredients-They-rewite-requests-to-http-yoursite-com-and" class="headerlink" title="ingredients. They rewite requests to http://yoursite.com and"></a>ingredients. They rewite requests to <a target="_blank" rel="noopener" href="http://yoursite.com/">http://yoursite.com</a> and</h1><h1 id="pass-the-entire-request-rhough-to-Zope-on"><a href="#pass-the-entire-request-rhough-to-Zope-on" class="headerlink" title="pass the entire request rhough to Zope on"></a>pass the entire request rhough to Zope on</h1><h1 id="http-yoursite-com-8080-The-VirtualHostBase-ensures-that"><a href="#http-yoursite-com-8080-The-VirtualHostBase-ensures-that" class="headerlink" title="http://yoursite.com:8080. The VirtualHostBase ensures that"></a><a target="_blank" rel="noopener" href="http://yoursite.com:8080/">http://yoursite.com:8080</a>. The VirtualHostBase ensures that</h1><h1 id="when-the-page-goes-back-to-the-browser-it-goes-out-through"><a href="#when-the-page-goes-back-to-the-browser-it-goes-out-through" class="headerlink" title="when the page goes back to the browser, it goes out through"></a>when the page goes back to the browser, it goes out through</h1><h1 id="Apache-and-appears-to-have-come-from-http-yoursite-com"><a href="#Apache-and-appears-to-have-come-from-http-yoursite-com" class="headerlink" title="Apache, and appears to have come from http://yoursite.com."></a>Apache, and appears to have come from <a target="_blank" rel="noopener" href="http://yoursite.com/">http://yoursite.com</a>.</h1><h1 id="The-line-is-made-up-from"><a href="#The-line-is-made-up-from" class="headerlink" title="The line is made up from:"></a>The line is made up from:</h1><h1 id="ProxyPass-or-ProxyPassReverse"><a href="#ProxyPass-or-ProxyPassReverse" class="headerlink" title="ProxyPass or ProxyPassReverse"></a>ProxyPass or ProxyPassReverse</h1><h1 id="is-the-url-at-http-yoursite-com-that-you-wish-to-use-to"><a href="#is-the-url-at-http-yoursite-com-that-you-wish-to-use-to" class="headerlink" title="&#x2F; is the url at http://yoursite.com that you wish to use to"></a>&#x2F; is the url at <a target="_blank" rel="noopener" href="http://yoursite.com/">http://yoursite.com</a> that you wish to use to</h1><h1 id="point-to-the-Zope-site-You-could-keep-http-yoursite-com-as-a"><a href="#point-to-the-Zope-site-You-could-keep-http-yoursite-com-as-a" class="headerlink" title="point to the Zope site. You could keep http://yoursite.com as a"></a>point to the Zope site. You could keep <a target="_blank" rel="noopener" href="http://yoursite.com/">http://yoursite.com</a> as a</h1><h1 id="flat-HTML-site-in-Apache-and-replace-with-zope-to-make"><a href="#flat-HTML-site-in-Apache-and-replace-with-zope-to-make" class="headerlink" title="flat HTML site in Apache, and replace &#x2F; with &#x2F;zope to make"></a>flat HTML site in Apache, and replace &#x2F; with &#x2F;zope to make</h1><h1 id="http-yoursite-com-zope-point-to-your-zope-site"><a href="#http-yoursite-com-zope-point-to-your-zope-site" class="headerlink" title="http://yoursite/com/zope point to your zope site."></a><a target="_blank" rel="noopener" href="http://yoursite/com/zope">http://yoursite/com/zope</a> point to your zope site.</h1><h1 id="http-yoursite-com-8080-is-the-address-that-your-zope-is"><a href="#http-yoursite-com-8080-is-the-address-that-your-zope-is" class="headerlink" title="http://yoursite.com:8080 is the address that your zope is"></a><a target="_blank" rel="noopener" href="http://yoursite.com:8080/">http://yoursite.com:8080</a> is the address that your zope is</h1><h1 id="running-on"><a href="#running-on" class="headerlink" title="running on."></a>running on.</h1><h1 id="VirtualHostBase-http-yoursite-com-80-makes-sure-that-zope"><a href="#VirtualHostBase-http-yoursite-com-80-makes-sure-that-zope" class="headerlink" title="&#x2F;VirtualHostBase&#x2F;http&#x2F;yoursite.com:80 makes sure that zope"></a>&#x2F;VirtualHostBase&#x2F;http&#x2F;yoursite.com:80 makes sure that zope</h1><h1 id="thinks-it-is-running-at-http-yousite-com-instead-of-at"><a href="#thinks-it-is-running-at-http-yousite-com-instead-of-at" class="headerlink" title="thinks it is running at http://yousite.com instead of at"></a><em>thinks</em> it is running at <a target="_blank" rel="noopener" href="http://yousite.com/">http://yousite.com</a> instead of at</h1><h1 id="http-yoursite-com-8080-You-don’t-have-to-do-anything-else"><a href="#http-yoursite-com-8080-You-don’t-have-to-do-anything-else" class="headerlink" title="http://yoursite.com:8080. You don’t have to do anything else"></a><a target="_blank" rel="noopener" href="http://yoursite.com:8080/">http://yoursite.com:8080</a>. You don’t have to do anything else</h1><h1 id="in-Zope-to-make-this-work"><a href="#in-Zope-to-make-this-work" class="headerlink" title="in Zope to make this work."></a>in Zope to make this work.</h1><h1 id="yourplonesite-is-the-location-of-your-Plone-Site-within-Zope"><a href="#yourplonesite-is-the-location-of-your-Plone-Site-within-Zope" class="headerlink" title="&#x2F;yourplonesite is the location of your Plone Site within Zope."></a>&#x2F;yourplonesite is the location of your Plone Site within Zope.</h1><h1 id="If-you-added-a-Plone-Site-into-the-root-of-your-Zope-with-an-id"><a href="#If-you-added-a-Plone-Site-into-the-root-of-your-Zope-with-an-id" class="headerlink" title="If you added a Plone Site into the root of your Zope with an id"></a>If you added a Plone Site into the root of your Zope with an id</h1><h1 id="of-‘mysite’-then-you-just-change-this-bit-to-mysite"><a href="#of-‘mysite’-then-you-just-change-this-bit-to-mysite" class="headerlink" title="of ‘mysite’, then you just change this bit to &#x2F;mysite"></a>of ‘mysite’, then you just change this bit to &#x2F;mysite</h1><h1 id="VirtualHostRoot-makes-your-Plone-site-think-it-is-the-root-of-the-site"><a href="#VirtualHostRoot-makes-your-Plone-site-think-it-is-the-root-of-the-site" class="headerlink" title="&#x2F;VirtualHostRoot&#x2F; makes your Plone site think it is the root of the site."></a>&#x2F;VirtualHostRoot&#x2F; makes your Plone site think it is the root of the site.</h1><p> ProxyPass &#x2F; <a target="_blank" rel="noopener" href="http://yoursite.com:8080/VirtualHostBase/http/yoursite.com:80/yourplonesite/VirtualHostRoot/">http://yoursite.com:8080/VirtualHostBase/http/yoursite.com:80/yourplonesite/VirtualHostRoot/</a><br> ProxyPassReverse &#x2F; <a target="_blank" rel="noopener" href="http://yoursite.com:8080/VirtualHostBase/http/yoursite.com:80/yourplonesite/VirtualHostRoot/">http://yoursite.com:8080/VirtualHostBase/http/yoursite.com:80/yourplonesite/VirtualHostRoot/</a><br> </VirtualHost></p>
<p>现在重启apache, 你应当能够看到<a target="_blank" rel="noopener" href="http://yoursite.com已经变成你的plone网站了.(如果你有任何问题,首先要确保/etc/httpd/modules/%E7%9B%AE%E5%BD%95%E4%B8%AD%E6%9C%89libproxy.so">http://yoursite.com已经变成你的Plone网站了。（如果你有任何问题，首先要确保/etc/httpd/modules/目录中有libproxy.so</a>)</p>
<p>下载，你已经有了一个很好的设置：Apache专门用来接受web请求，而Zope是后断服务器。你现在还可以就有一个完全的虚拟主机的设置，因此你可以在只有单个IP地址的单个服务器上运行多个不同域名的网站。你需要作的所有工作就是复制并编辑每个网站的VirtualHost部分。</p>
<p>现在，你可能想看看这样的设置运行速度有多快。要知道的是，至此，我们并没有获得任何真正的速度提速，我们只是为此进行了一些基础工作。你可以在一台终端上使用Apache Benchmark程序来测试网站的速度。该程序通常在 ‘&#x2F;usr&#x2F;sbin&#x2F;ab’</p>
<p>&#x2F;usr&#x2F;sbin&#x2F;ab -n 100 <a target="_blank" rel="noopener" href="http://yousite.com/">http://yousite.com/</a></p>
<p>该命令会发送100次连续的请求到你的网站。你应当注意到请求需要大约0.5-1.0秒，没有很大的变化。虽然这样的结果对于一个动态页面来说不是太糟糕，但要记住该测试提取的仅仅是一个HTML页面。对于完整的带有CSS、Javascript和图片的页面，处理时间会长挺多的。</p>
<p>该测试的典型的输出结果像这样:</p>
<p>Benchmarking yoursite.com (be patient)…..done<br>Server Software: Zope&#x2F;(unreleased<br>Server Hostname: yoursite.com<br>Server Port: 80<br>Document Path: &#x2F;<br>Document Length: 32560 bytes<br>Concurrency Level: 1<br>Time taken for tests: 68.901 seconds<br>Complete requests: 100<br>Failed requests: 0<br>Broken pipe errors: 0<br>Total transferred: 3293500 bytes<br>HTML transferred: 3256000 bytes<br>Requests per second: 1.45 [#&#x2F;sec] (mean)<br>Time per request: 689.01 [ms] (mean)<br>Time per request: 689.01 [ms] (mean, across all concurrent requests)<br>Transfer rate: 47.80 [Kbytes&#x2F;sec] received</p>
<p>那么，我们任何才能提高速度呢？</p>
<p>我们能够做的第一件事是让Apache缓存页面结果。由于我们采用Apache作为前端服务器，因此通过完全可以做到，我们已经创建了一个带有缓存的反向代理，也就是说，所有的Zope生成的页面现在都通过Apache来传递给浏览器，并且可以被缓存起来，显著提高页面访问的性能。只是现在我们还没有告诉Apache要缓存任何东西。</p>
<p>要让Apache知道我们希望缓存的、具有某个过期时间设置的内容，必须安装mod_expires。查看你的Apache模块目录（通常为&#x2F;etc&#x2F;httpd&#x2F;modules)时候有mod_expires.so,然后确认你的Apache配置文件中有下面几行:</p>
<p>LoadModule expires_module modules&#x2F;mod_expires.so<br>AddModule mod_expires.c</p>
<p>现在，在你的虚拟主机部分，在</VirtualHost>行之前添加下面几行:</p>
<h1 id="CacheRoot-is-the-location-on-the-filesystem-to-store-files-that"><a href="#CacheRoot-is-the-location-on-the-filesystem-to-store-files-that" class="headerlink" title="CacheRoot is the location on the filesystem to store files that"></a>CacheRoot is the location on the filesystem to store files that</h1><h1 id="Apache-caches-This-directory-must-be-created-and-the-user-that"><a href="#Apache-caches-This-directory-must-be-created-and-the-user-that" class="headerlink" title="Apache caches. This directory must be created, and the user that"></a>Apache caches. This directory must be created, and the user that</h1><h1 id="Apache-runs-as-must-have-full-write-permissions-to-it"><a href="#Apache-runs-as-must-have-full-write-permissions-to-it" class="headerlink" title="Apache runs as must have full write permissions to it."></a>Apache runs as must have full write permissions to it.</h1><p>CacheRoot “&#x2F;tmp&#x2F;proxy&#x2F;yoursite.com”</p>
<h1 id="CacheSize-determines-how-big-this-cache-can-get-in-KB-It’s-a"><a href="#CacheSize-determines-how-big-this-cache-can-get-in-KB-It’s-a" class="headerlink" title="CacheSize determines how big this cache can get in KB. It’s a"></a>CacheSize determines how big this cache can get in KB. It’s a</h1><h1 id="good-idea-that-this-number-is-about-30-less-than-the-available"><a href="#good-idea-that-this-number-is-about-30-less-than-the-available" class="headerlink" title="good idea that this number is about 30% less than the available"></a>good idea that this number is about 30% less than the available</h1><h1 id="space-in-the-CacheRoot-directory-Here-we-choose-to-cache-10MB"><a href="#space-in-the-CacheRoot-directory-Here-we-choose-to-cache-10MB" class="headerlink" title="space in the CacheRoot directory. Here we choose to cache 10MB"></a>space in the CacheRoot directory. Here we choose to cache 10MB</h1><h1 id="of-data-which-is-enough-for-a-personal-website-but-not-for"><a href="#of-data-which-is-enough-for-a-personal-website-but-not-for" class="headerlink" title="of data, which is enough for a personal website, but not for"></a>of data, which is enough for a personal website, but not for</h1><h1 id="anything-larger"><a href="#anything-larger" class="headerlink" title="anything larger."></a>anything larger.</h1><p>CacheSize 10000</p>
<h1 id="CacheGcInterval-specifies-how-often-in-hours-to-examine-the"><a href="#CacheGcInterval-specifies-how-often-in-hours-to-examine-the" class="headerlink" title="CacheGcInterval specifies how often (in hours) to examine the"></a>CacheGcInterval specifies how often (in hours) to examine the</h1><h1 id="cache-and-delete-obsolete-files"><a href="#cache-and-delete-obsolete-files" class="headerlink" title="cache and delete obsolete files."></a>cache and delete obsolete files.</h1><p>CacheGcInterval 2</p>
<h1 id="CacheLastModifiedFactor-allows-the-estimation-of-an-expiry-date"><a href="#CacheLastModifiedFactor-allows-the-estimation-of-an-expiry-date" class="headerlink" title="CacheLastModifiedFactor allows the estimation of an expiry date"></a>CacheLastModifiedFactor allows the estimation of an expiry date</h1><h1 id="for-a-page-if-it-doesn’t-have-an-expiry-date-specified-in-the"><a href="#for-a-page-if-it-doesn’t-have-an-expiry-date-specified-in-the" class="headerlink" title="for a page if it doesn’t have an expiry-date specified in the"></a>for a page if it doesn’t have an expiry-date specified in the</h1><h1 id="HTTP-headers-returned-from-Zope-This-is-based-on-time-since"><a href="#HTTP-headers-returned-from-Zope-This-is-based-on-time-since" class="headerlink" title="HTTP headers returned from Zope. This is based on (time since"></a>HTTP headers returned from Zope. This is based on (time since</h1><h1 id="last-modification-CacheLastModifiedFactor-so-that-content"><a href="#last-modification-CacheLastModifiedFactor-so-that-content" class="headerlink" title="last modification * CacheLastModifiedFactor), so that content"></a>last modification * CacheLastModifiedFactor), so that content</h1><h1 id="that-is-ten-hours-old-would-be-given-an-expiry-date-of-1-hour-in"><a href="#that-is-ten-hours-old-would-be-given-an-expiry-date-of-1-hour-in" class="headerlink" title="that is ten hours old would be given an expiry date of 1 hour in"></a>that is ten hours old would be given an expiry date of 1 hour in</h1><h1 id="the-future"><a href="#the-future" class="headerlink" title="the future."></a>the future.</h1><p>CacheLastModifiedFactor 0.1</p>
<h1 id="CacheDefaultExpire-sets-a-default-expiry-time-of-1-hour-into-the"><a href="#CacheDefaultExpire-sets-a-default-expiry-time-of-1-hour-into-the" class="headerlink" title="CacheDefaultExpire sets a default expiry time of 1 hour into the"></a>CacheDefaultExpire sets a default expiry time of 1 hour into the</h1><h1 id="future-for-cached-pages"><a href="#future-for-cached-pages" class="headerlink" title="future for cached pages."></a>future for cached pages.</h1><p>CacheDefaultExpire 1</p>
<h1 id="CacheDirLength-sets-the-number-of-characters-used-in-directory"><a href="#CacheDirLength-sets-the-number-of-characters-used-in-directory" class="headerlink" title="CacheDirLength sets the number of characters used in directory"></a>CacheDirLength sets the number of characters used in directory</h1><h1 id="names-for-subdirectories-of-CacheRoot"><a href="#names-for-subdirectories-of-CacheRoot" class="headerlink" title="names for subdirectories of CacheRoot"></a>names for subdirectories of CacheRoot</h1><p>CacheDirLength 2</p>
<h1 id="The-following-definitions-set-expiry-times-for-various-content"><a href="#The-following-definitions-set-expiry-times-for-various-content" class="headerlink" title="The following definitions set expiry times for various content"></a>The following definitions set expiry times for various content</h1><h1 id="types-In-this-list-each-content-type-defined-is-cached-for-a"><a href="#types-In-this-list-each-content-type-defined-is-cached-for-a" class="headerlink" title="types. In this list, each content type defined is cached for a"></a>types. In this list, each content type defined is cached for a</h1><h1 id="maximum-period-of-1-hour-3600-seconds-before-it-must-be-checked"><a href="#maximum-period-of-1-hour-3600-seconds-before-it-must-be-checked" class="headerlink" title="maximum period of 1 hour (3600 seconds) before it must be checked"></a>maximum period of 1 hour (3600 seconds) before it must be checked</h1><h1 id="again-Non-listed-content-types-are-not-cached"><a href="#again-Non-listed-content-types-are-not-cached" class="headerlink" title="again. Non-listed content types are not cached."></a>again. Non-listed content types are not cached.</h1><p>ExpiresActive On<br>ExpiresByType image&#x2F;gif A3600<br>ExpiresByType image&#x2F;png A3600<br>ExpiresByType image&#x2F;jpeg A3600<br>ExpiresByType text&#x2F;css A3600<br>ExpiresByType text&#x2F;javascript A3600<br>ExpiresByType application&#x2F;x-javascript A3600<br>ExpiresByType text&#x2F;html A3600<br>ExpiresByType text&#x2F;xml A3600</p>
<p>完成后，保持配置文件。然后进入&#x2F;tmp文件夹，此机一个刚才你编辑的配置文件中CacheRoot定义的目录，修改该目录的权限为apache用户可写。在我们的例子中，是这样的:</p>
<p>mkdir &#x2F;tmp&#x2F;proxy<br>mkdir &#x2F;tmp&#x2F;proxy&#x2F;yoursite.com<br>chown -R apache:apache &#x2F;tmp&#x2F;proxy&#x2F;yoursite.com</p>
<p>现在重启Apache让修改的配置生效。</p>
<p>至此，尽管Apache能够处理缓存，但是还没有缓存你的Plone网站中的任何页面。我们可以用wget来测试一下HTTP响应报文的报头:</p>
<p>wget -sS –delete-after <a target="_blank" rel="noopener" href="http://yoursite.com/">http://yoursite.com/</a><br>–03:16:51– <a target="_blank" rel="noopener" href="http://yoursite.com/">http://yoursite.com/</a><br>&#x3D;&gt; &#96;index.html’<br>Resolving yoursite.com… done.<br>Connecting to yoursite.com[127.0.0.1]:80… connected.<br>HTTP request sent, awaiting response…<br>1 HTTP&#x2F;1.1 200 OK<br>2 Date: Mon, 19 Jan 2004 03:16:51 GMT<br>3 Server: Zope&#x2F;(unreleased version, python 2.3.2, linux2) ZServer&#x2F;1.1 Plone&#x2F;2.0-RC3<br>4 Vary: Accept-Encoding<br>5 Content-Length: 32560<br>6 Content-Language:<br>7 Expires: Mon, 19 Jan 2004 04:16:52 GMT<br>8 Etag:<br>9 Cache-Control: max-age&#x3D;3600<br>10 Content-Type: text&#x2F;html;charset&#x3D;utf-8<br>11 X-Cache: MISS from yoursite.com<br>12 Connection: close</p>
<p>注意X-Cache报头显示缓存标志为MISS（缓存中没有的标志）.首次访问一个页面时会遇到这样的情况（因为该页面的内容尚未被缓存），如果缓存正常的话，在后续对该页面的请求中，我们会遇到HIT（在缓存中的标志）。</p>
<p>接下来，在Apache成为一个有用的缓存器之前，需要设置你得内容页面的HTTP报头的属性，这样Zope就会告诉Apache哪些东西需要缓存，哪些不要缓存。不幸的是，由于Zope的Accelrated HTTP Cache Mangaer中有一个尚未解决的bug，设置工作比设想的要复杂一些。</p>
<p>首先，你需要编辑Accelerated HTTP Cache Manager的源代码。即Zope目录中的lib&#x2F;python&#x2F;Products&#x2F;StandardCacheManagers&#x2F;AcceleratedHTTPCacheManager.py.</p>
<p>把ZCache_set函数的最后部分(在101行附近）改为:</p>
<h1 id="Set-HTTP-Expires-and-Cache-Control-headers"><a href="#Set-HTTP-Expires-and-Cache-Control-headers" class="headerlink" title="Set HTTP Expires and Cache-Control headers"></a>Set HTTP Expires and Cache-Control headers</h1><p>seconds&#x3D;self.interval<br>expires&#x3D;rfc1123_date(time.time() + seconds)</p>
<h1 id="note-that-in-the-original-this-line-was-commented-out"><a href="#note-that-in-the-original-this-line-was-commented-out" class="headerlink" title="note that in the original, this line was commented out."></a>note that in the original, this line was commented out.</h1><p>RESPONSE.setHeader(‘Last-Modified’,rfc1123_date(time.time()))<br>RESPONSE.setHeader(‘Cache-Control’, ‘max-age&#x3D;%d’ % seconds)<br>RESPONSE.setHeader(‘Expires’, expires)</p>
<p>这样就能够确保Zope返回一个有效的Last-Modified HTTP报头。如果没有这样修改，缓存会假设你的内容是动态生成的，不适合进行缓存。</p>
<p>现在，重启Zope使修改生效。</p>
<p>现在，你得系统具有了完整的缓存处理能力，接下来所要作的就是告诉你的Plone站点的Accelerated HTTP Cache Manager 应当缓存哪些内容。</p>
<p>用管理员权限的用户登入Zope站点，在ZMI中进入Plone。点击HTTPCache,查看Associate页签。注意，当前还没有任何相关的内容。</p>
<p>When associating items with the HTTPCache, you’re not associating content items, instead you associate the different views available. This means that you can ensure that your view template is cached, but edit templates are not. Ensuring that the options All for Locate Cacheable Objects</p>
<p>在关联HTTPCache内容条目时，你并不是把内容条目关联起来，二十把不同的可用的视图关联起来。就是说你可以确认你得视图模板被缓存起来，而编辑模板没有被缓存起来。需要确认的是选择Locate Cacheable Object的ALL、types(s)的ALL、和搜索Subfolders都已经选定，然后点击Locate按钮。稍过一会，你会看到你的网站中所有的皮肤元素中的一个列表。</p>
<p>需要特别注意的是你所选择的那些条目。你可以缓存所有的图片、文件、CSS和所有的JavaScripts.此外，你应当确认所有内容类型的view模板被缓存（比如，新闻项的newsitem_view）。特别注意的是在另一个皮肤文件夹中定制的那些条目。</p>
<p>现在，你应当有了一个非常长的缓存项列表，点击SAVE保存修改。</p>
<p>假设你已经正确完成上面的工作，你会发现Apache已经开始缓存你的页面。我们使用wget来测试，其输出的HTTP响应报头如下:</p>
<p>wget -sS –delete-after <a target="_blank" rel="noopener" href="http://yoursite.com/">http://yoursite.com/</a><br>–03:28:46– <a target="_blank" rel="noopener" href="http://yoursite.com/">http://yoursite.com/</a><br>&#x3D;&gt; &#96;index.html’<br>Resolving yoursite.com… done.<br>Connecting to poked.org[217.199.181.94]:80… connected.<br>HTTP request sent, awaiting response…<br>1 HTTP&#x2F;1.1 200 OK<br>2 Date: Mon, 19 Jan 2004 03:28:46 GMT<br>3 Server: Zope&#x2F;(unreleased version, python 2.3.2, linux2) ZServer&#x2F;1.1 Plone&#x2F;2.0-RC3<br>4 Vary: Accept-Encoding<br>5 Content-Length: 32125<br>6 Expires: Mon, 19 Jan 2004 04:28:43 GMT<br>7 Last-Modified: Mon, 19 Jan 2004 03:28:43 GMT<br>8 Cache-Control: max-age&#x3D;3600<br>9 Content-Type: text&#x2F;html;charset&#x3D;utf-8<br>10 Age: 4<br>11 X-Cache: HIT from yoursite.com<br>12 Connection: close</p>
<p>注意，下载X-Cache的报头为cache HIT。这正是我们要的结果。</p>
<p>既然Apache已经缓存了你的Plone页面，你就可以测试一下，看看有什么不同。还是使用Apache Benchmark工具，我们可以这样测试:</p>
<p>&#x2F;usr&#x2F;sbin&#x2F;ab -n 100 <a target="_blank" rel="noopener" href="http://yoursite.com/">http://yoursite.com/</a><br>Benchmarking poked.org (be patient)…..done<br>Server Software: Zope&#x2F;(unreleased<br>Server Hostname: yoursite.com<br>Server Port: 80<br>Document Path: &#x2F;<br>Document Length: 32125 bytes<br>Concurrency Level: 1<br>Time taken for tests: 0.116 seconds<br>Complete requests: 100<br>Failed requests: 0<br>Broken pipe errors: 0<br>Total transferred: 3252200 bytes<br>HTML transferred: 3212500 bytes<br>Requests per second: 862.07 [#&#x2F;sec] (mean)<br>Time per request: 1.16 [ms] (mean)<br>Time per request: 1.16 [ms] (mean, across all concurrent requests)<br>Transfer rate: 28036.21 [Kbytes&#x2F;sec] received</p>
<p>Note particulary the time taken for this test: 0.116 seconds, or a much healtier 0.0016 seconds per request! This gives some indication of how fast this site will be capable of running.</p>
<p>特别注意该测试使用的时间:0.116秒，或者是更有价值的每个请求的处理时间为0.0016!这是网站能够运行有多快的指标。</p>
<p>使用Apache Benchmark连续测试100次请求难以真正的评估出你的网站的运行速度，不过，要真正的模拟评估，需要使用并发特性，他可以让你同时发送请求。本例中ab用同时100个请求的方式共进行10000次的请求。这是相当于企业级的中／大型网站的负载量:</p>
<p>&#x2F;usr&#x2F;sbin&#x2F;ab -n 100000 -c 100 <a target="_blank" rel="noopener" href="http://yoursite.com/">http://yoursite.com/</a><br>Benchmarking poked.org (be patient)<br>Server Software: Zope&#x2F;(unreleased<br>Server Hostname: poked.org<br>Server Port: 80<br>Document Path: &#x2F;<br>Document Length: 32125 bytes<br>Concurrency Level: 100<br>Time taken for tests: 115.732 seconds<br>Complete requests: 100000<br>Failed requests: 0<br>Broken pipe errors: 0<br>Total transferred: -1041856680 bytes<br>HTML transferred: -1081567796 bytes<br>Requests per second: 864.07 [#&#x2F;sec] (mean)<br>Time per request: 115.73 [ms] (mean)<br>Time per request: 1.16 [ms] (mean, across all concurrent requests)<br>Transfer rate: -9002.32 [Kbytes&#x2F;sec] received</p>
<p>These results show that the combination of Apache and Zope is capable of serving 100000 requests in just under 2 minutes. It’s worth pointing out again that this is on a 1.8GHz Intel Celeron with only 128MB of RAM, running a basic Redhat 7.3 setup, which is very, very slow for a production server. On a typical Dual Intel Xeon 2.4GHz server with 1GB of RAM, expect a speed increase of over 100%.</p>
<p>该结果显示Apache和Zope的组合能够在2分钟内处理100000个请求。值对一提的是这是在一台运行基本Redhat7.3配置的、 1.8GHz仅有128MB内存的IntelCeleron服务器，这对于一个生产服务器来说是非常、非常慢的。在一台典型的双Intel Xeon 2.4GHz CPU、1GB内存的服务器上，处理速度可以提高超过100%。</p>
<p>值对一提的是这样的缓存是有一定的局限的。把Last-Modified报头设置成页面提取的时间，并且把最大时效设置为3600秒，该网站中的所有内容的生命周期都是1个小时。这就是说在最坏情况下，该网站的更新会在一个小时后才发生。这可以通过强制对某个特定页面进行缓存校验来解决，只需要在浏览器中进行CTRL－刷新页面即可。</p>
<p>另一个局限在于，如果你使用你的主域名来登入和编辑你的Plone网站，你可能会在浏览器中遇到一些奇怪的情况，比如无法正确缓存报头。一个简单的办法是为需要编辑网站的用户添加一个之域，比如cms.yoursite.com。这样，在你的Apache配置文件中，只需要为你得CMS简单新建一个没有任何缓存设置的VirtualHost部分。:</p>
<p>&lt;VirtualHost *&gt;<br>ServerName cms.yoursite.com<br>ServerAdmin <a href="mailto:&#x77;&#x65;&#98;&#x6d;&#x61;&#x73;&#116;&#x65;&#x72;&#x40;&#121;&#x6f;&#x75;&#x72;&#115;&#x69;&#x74;&#101;&#x2e;&#99;&#111;&#109;">&#x77;&#x65;&#98;&#x6d;&#x61;&#x73;&#116;&#x65;&#x72;&#x40;&#121;&#x6f;&#x75;&#x72;&#115;&#x69;&#x74;&#101;&#x2e;&#99;&#111;&#109;</a><br>ProxyPass &#x2F; <a target="_blank" rel="noopener" href="http://cms.yoursite.com:8080/VirtualHostBase/http/cms.yoursite.com:80/yourplonesite/VirtualHostRoot/">http://cms.yoursite.com:8080/VirtualHostBase/http/cms.yoursite.com:80/yourplonesite/VirtualHostRoot/</a><br>ProxyPassReverse &#x2F; <a target="_blank" rel="noopener" href="http://cms.yoursite.com:8080/VirtualHostBase/http/cms.yoursite.com:80/yourplonesite/VirtualHostRoot/">http://cms.yoursite.com:8080/VirtualHostBase/http/cms.yoursite.com:80/yourplonesite/VirtualHostRoot/</a><br></VirtualHost></p>
<p>这样，任何需要编辑网站内容的人都会整个绕过缓存。</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/%E8%A7%A3%E5%86%B3wordpress27%E8%BF%90%E8%A1%8C%E5%8D%81%E5%88%86%E7%BC%93%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98/">解决Wordpress2.7运行十分缓慢的问题</a><a class="next" href="/%E5%A6%82%E4%BD%95%E4%BB%8E-blogbus-%E6%90%AC%E5%AE%B6%E5%88%B0-wordpress/">如何从 BlogBus 搬家到 WordPress</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="输入关键词搜索"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/%E5%AE%B6%E5%BA%AD%E7%BD%91%E7%BB%9C%E5%86%8D%E6%AC%A1%E4%BC%98%E5%8C%96%EF%BC%9A%E5%87%8F%E5%B0%91%E5%A4%8D%E6%9D%82%E6%80%A7%E5%87%8F%E5%B0%91%E8%AE%BE%E5%A4%87/">家庭网络再次优化：减少复杂性减少设备</a></li><li class="post-list-item"><a class="post-list-link" href="/%E5%8C%97%E4%BA%AC%E8%81%94%E9%80%9A%E6%9B%B4%E6%8D%A2%E5%85%89%E7%8C%AB%E7%83%BD%E7%81%ABhg5582a/">北京联通更换光猫烽火HG5582A</a></li><li class="post-list-item"><a class="post-list-link" href="/%E9%9D%9E%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%ACr%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98/">非最新版本R安装软件包依赖问题</a></li><li class="post-list-item"><a class="post-list-link" href="/pycharm-r%E8%84%9A%E6%9C%AC%E7%94%BB%E5%9B%BE%E4%B8%8D%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/">PyCharm R脚本 画图不显示问题</a></li><li class="post-list-item"><a class="post-list-link" href="/%E5%AE%B6%E5%BA%AD%E7%BD%91%E7%BB%9C%E5%8D%87%E7%BA%A7300m-1000m/">家庭网络升级300M-1000M</a></li><li class="post-list-item"><a class="post-list-link" href="/win11-23h2-%E5%8D%87%E7%BA%A724h2/">Win11 23H2 升级24H2：使用微软官方工具MBR2GPT转换磁盘MBR->GPT</a></li><li class="post-list-item"><a class="post-list-link" href="/%E6%9C%89%E9%81%93%E4%BA%91%E7%AC%94%E8%AE%B0%E4%B8%A4%E4%B8%AA%E8%B4%A6%E5%8F%B7%E5%90%88%E5%B9%B6%EF%BC%88%E7%BD%91%E6%98%93%E9%82%AE%E7%AE%B1%E5%8F%8A%E5%BE%AE%E4%BF%A1%E8%B4%A6%E5%8F%B7%EF%BC%89/">有道云笔记两个账号合并（网易邮箱及微信账号）</a></li><li class="post-list-item"><a class="post-list-link" href="/kms%E5%B7%A5%E5%85%B7%E6%BF%80%E6%B4%BBoffice-ltsc-%E6%8A%A5%E9%94%99-error-code-0x80080005/">KMS工具激活Office LTSC 报错 Error Code: 0x80080005</a></li><li class="post-list-item"><a class="post-list-link" href="/vmware-esxi-%E7%94%B15-5%E5%8D%87%E7%BA%A7%E5%88%B07-0/">VMware ESXi 由5.5升级到7.0</a></li><li class="post-list-item"><a class="post-list-link" href="/%E5%B0%8F%E7%B1%B38-%E5%88%B7%E7%AC%AC%E4%B8%89%E6%96%B9%E5%9B%BA%E4%BB%B6%E5%A7%8B%E6%9C%AB/">小米8 刷第三方固件始末</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/lib/" style="font-size: 15px;">lib</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/php%E5%BC%80%E6%BA%90%E7%A8%8B%E5%BA%8F/" style="font-size: 15px;">php开源程序</a> <a href="/tags/301/" style="font-size: 15px;">301</a> <a href="/tags/html/" style="font-size: 15px;">html</a> <a href="/tags/access-connections/" style="font-size: 15px;">access connections</a> <a href="/tags/Thinkpad/" style="font-size: 15px;">Thinkpad</a> <a href="/tags/adobe/" style="font-size: 15px;">adobe</a> <a href="/tags/ajax/" style="font-size: 15px;">ajax</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/spry/" style="font-size: 15px;">spry</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/a2ensite/" style="font-size: 15px;">a2ensite</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 15px;">经验</a> <a href="/tags/htaccess/" style="font-size: 15px;">htaccess</a> <a href="/tags/bash/" style="font-size: 15px;">bash</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/windows10/" style="font-size: 15px;">windows10</a> <a href="/tags/bitcoin/" style="font-size: 15px;">bitcoin</a> <a href="/tags/p2p/" style="font-size: 15px;">p2p</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97/" style="font-size: 15px;">分布式计算</a> <a href="/tags/blackboard/" style="font-size: 15px;">blackboard</a> <a href="/tags/bb/" style="font-size: 15px;">bb</a> <a href="/tags/buffering/" style="font-size: 15px;">buffering</a> <a href="/tags/output/" style="font-size: 15px;">output</a> <a href="/tags/output-buffering/" style="font-size: 15px;">output_buffering</a> <a href="/tags/php-ini/" style="font-size: 15px;">php.ini</a> <a href="/tags/centos/" style="font-size: 15px;">centos</a> <a href="/tags/iptables/" style="font-size: 15px;">iptables</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/cdrom/" style="font-size: 15px;">cdrom</a> <a href="/tags/CentOS/" style="font-size: 15px;">CentOS</a> <a href="/tags/yum/" style="font-size: 15px;">yum</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 15px;">运维</a> <a href="/tags/clear/" style="font-size: 15px;">clear</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/ie6/" style="font-size: 15px;">ie6</a> <a href="/tags/%E5%8D%A0%E7%94%A8%E9%AB%98%E5%BA%A6/" style="font-size: 15px;">占用高度</a> <a href="/tags/ckeditor/" style="font-size: 15px;">ckeditor</a> <a href="/tags/wordpress/" style="font-size: 15px;">wordpress</a> <a href="/tags/gd/" style="font-size: 15px;">gd</a> <a href="/tags/imagecreate/" style="font-size: 15px;">imagecreate</a> <a href="/tags/dfGallery/" style="font-size: 15px;">dfGallery</a> <a href="/tags/dotproject/" style="font-size: 15px;">dotproject</a> <a href="/tags/project/" style="font-size: 15px;">project</a> <a href="/tags/N-A/" style="font-size: 15px;">#N/A</a> <a href="/tags/excel/" style="font-size: 15px;">excel</a> <a href="/tags/Office%E6%8A%80%E5%B7%A7/" style="font-size: 15px;">Office技巧</a> <a href="/tags/office/" style="font-size: 15px;">office</a> <a href="/tags/compact/" style="font-size: 15px;">compact</a> <a href="/tags/extract/" style="font-size: 15px;">extract</a> <a href="/tags/fck%EF%BC%8Ceditor/" style="font-size: 15px;">fck，editor</a> <a href="/tags/ftp/" style="font-size: 15px;">ftp</a> <a href="/tags/buzz/" style="font-size: 15px;">buzz</a> <a href="/tags/google/" style="font-size: 15px;">google</a> <a href="/tags/hosts/" style="font-size: 15px;">hosts</a> <a href="/tags/ipv6/" style="font-size: 15px;">ipv6</a> <a href="/tags/%E6%9C%80%E6%96%B0%E8%B5%84%E8%AE%AF/" style="font-size: 15px;">最新资讯</a> <a href="/tags/hook/" style="font-size: 15px;">hook</a> <a href="/tags/google-reader/" style="font-size: 15px;">google reader</a> <a href="/tags/flash/" style="font-size: 15px;">flash</a> <a href="/tags/html4/" style="font-size: 15px;">html4</a> <a href="/tags/Web-Applacation/" style="font-size: 15px;">Web Applacation</a> <a href="/tags/insert-ino/" style="font-size: 15px;">insert ino</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/sql/" style="font-size: 15px;">sql</a> <a href="/tags/update/" style="font-size: 15px;">update</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/jpgraph/" style="font-size: 15px;">jpgraph</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/jeecms/" style="font-size: 15px;">jeecms</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/jQuery-lightBox/" style="font-size: 15px;">jQuery lightBox</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/0x80080005/" style="font-size: 15px;">0x80080005</a> <a href="/tags/kms/" style="font-size: 15px;">kms</a> <a href="/tags/SppExtComObj/" style="font-size: 15px;">SppExtComObj</a> <a href="/tags/pchart/" style="font-size: 15px;">pchart</a> <a href="/tags/limesurvey/" style="font-size: 15px;">limesurvey</a> <a href="/tags/fckeditor/" style="font-size: 15px;">fckeditor</a> <a href="/tags/%E4%B8%AD%E6%96%87%E5%AD%97%E4%BD%93/" style="font-size: 15px;">中文字体</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">网络</a> <a href="/tags/mb-substr/" style="font-size: 15px;">mb_substr</a> <a href="/tags/spss/" style="font-size: 15px;">spss</a> <a href="/tags/bootcamp/" style="font-size: 15px;">bootcamp</a> <a href="/tags/macbook/" style="font-size: 15px;">macbook</a> <a href="/tags/macos/" style="font-size: 15px;">macos</a> <a href="/tags/%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81/" style="font-size: 15px;">重置密码</a> <a href="/tags/rss/" style="font-size: 15px;">rss</a> <a href="/tags/ssh/" style="font-size: 15px;">ssh</a> <a href="/tags/MariaDB/" style="font-size: 15px;">MariaDB</a> <a href="/tags/mysqlnd/" style="font-size: 15px;">mysqlnd</a> <a href="/tags/mysq/" style="font-size: 15px;">mysq</a> <a href="/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/" style="font-size: 15px;">命令行</a> <a href="/tags/%E5%A4%87%E4%BB%BD/" style="font-size: 15px;">备份</a> <a href="/tags/%E8%BF%98%E5%8E%9F/" style="font-size: 15px;">还原</a> <a href="/tags/expires/" style="font-size: 15px;">expires</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">ICT经验网.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> Theme by<a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Maupassant.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>